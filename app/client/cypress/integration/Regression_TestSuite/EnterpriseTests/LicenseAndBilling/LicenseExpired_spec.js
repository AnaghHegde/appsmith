import locators from "../../../../locators/AdminsSettings";
import LicenseLocators from "../../../../locators/LicenseLocators.json";

describe("License expired", function () {
  it("1. should show ADMIN license expiry page", function () {
    cy.interceptLicenseApi({
      licenseStatus: "EXPIRED",
      licenseType: "PAID",
      active: false,
    });
    cy.LogOut();
    cy.LoginFromAPI(Cypress.env("USERNAME"), Cypress.env("PASSWORD"));
    cy.visit("/applications");
    cy.wait(2000);
    cy.url().should("contain", "/license");
    cy.get(LicenseLocators.noSubscriptionText).should(
      "have.text",
      "No active subscription",
    );
    cy.get(LicenseLocators.licenseCheckPageSubHeaderText).should(
      "have.text",
      "Kindly choose one of the following option to get started",
    );

    cy.get(LicenseLocators.licenseCheckForm).within(() => {
      cy.get(LicenseLocators.licenseFormInput).should(
        "have.attr",
        "placeholder",
        "Add Key",
      );
      cy.get(LicenseLocators.activeInstanceBtn).should("be.disabled");
    });

    cy.get(LicenseLocators.getTrialLicenseCard).within(() => {
      cy.get(LicenseLocators.getTrialLicenseLabel).should(
        "have.text",
        "If you do not have a license key, please visit our customer portal to start trial or buy a subscription",
      );
      cy.get(LicenseLocators.getTrialLicenseBtn).should(
        "have.text",
        "VISIT CUSTOMER PORTAL",
      );
    });
    cy.get(locators.appsmithHeader).should("be.visible");
    cy.get(locators.appsmithHeader).within(() => {
      cy.get(".t--profile-menu-icon").click();
    });
    cy.wait(1000);
    cy.get(".t--logout-icon").click();
    cy.wait(1000);
    cy.url().should("contain", "/login");
  });
  it("2. should show NON ADMIN license expiry page", function () {
    cy.interceptLicenseApi({
      licenseStatus: "EXPIRED",
      licenseType: "PAID",
      active: false,
    });
    cy.LoginFromAPI(Cypress.env("TESTUSERNAME1"), Cypress.env("TESTPASSWORD1"));
    cy.visit("/applications");
    cy.wait(2000);
    cy.url().should("contain", "/license");
    cy.get(".t--error-page-description").should(
      "have.text",
      "You currently do not have an Active Subscription. Please contact your instance administrator to activate the instance.",
    );
    cy.get(locators.appsmithHeader).should("be.visible");
    cy.get(locators.appsmithHeader).within(() => {
      cy.get(".t--profile-menu-icon").click();
    });
    cy.wait(1000);
    cy.get(".t--logout-icon").click();
    cy.wait(1000);
    cy.url().should("contain", "/login");
  });
});
